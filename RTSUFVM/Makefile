#######################################################################
#                                                                     #
#                     MAKEFILE 3D: Sequential & MPI                   #
#                      ---  Miguel Uh Zapata ---                      #
#                                 2019                                #
#                                                                     #
#######################################################################
#
# .__________________________________________________________________.
# |                                                                  |
# |                     Declaration of extension                     |
# |__________________________________________________________________|

.SUFFIXES:.F90

# .__________________________________________________________________.
# |                                                                  |
# |                   Compiler and editor of links                   |
# |__________________________________________________________________|
# |                                                                  |
# | Sequential:   FC  = gfortran                                     |
# | # Compiler Fortran77         : xlf                               |
# |                                                                  |
# |__________________________________________________________________|

# FC         = gfortran
FC         = mpif77
FLD        = $(FC)
RM         = /bin/rm -f
MV         = mv

#######################################################################
#                            COMPILATION                              #
#######################################################################




# .__________________________________________________________________.
# |                                                                  |
# |        Debugging options                                         |
# |__________________________________________________________________|

ODEB       = -qnooptimize 
FDEB       = -qcheck -qdbg  \
             -qinitauto=FF \
             -qhalt=l   

#######################################################################
#                         Fortran includes                            #
#######################################################################

# .__________________________________________________________________.
# |                                                                  |
# |        Fortran includes                                          |
# |__________________________________________________________________|

FHDRS      = \
             common.mpf

# .__________________________________________________________________.
# |                                                                  |
# |        Directories: object, source & input                       |
# |__________________________________________________________________|


OBJDIR    = bin
SRCDIR    = src
INPUTDIR  = input
VPATH     = ${SRCDIR}:\

# .__________________________________________________________________.
# |                                                                  |
# |        Objects Fortran                                           |
# |__________________________________________________________________|

FOBJS = \
        ${OBJDIR}/modules.o\
        ${OBJDIR}/uvfm.o\
        ${OBJDIR}/fluid.o\
        ${OBJDIR}/utility.o\

# .__________________________________________________________________.
# |                                                                  |
# |        Sources Fortran                                           |
# |__________________________________________________________________|

INC_COMMON = -I ${SRCDIR}/Include

# .__________________________________________________________________.
# |                                                                  |
# |        Compilation Fortran                                       |
# |                                                                  |
# |        Pour faire sortir les fichiers pre-compile avec cpp       |
# |        au lieu de les effacer ajouter -d apres $(FC)             |
# |__________________________________________________________________|


${OBJDIR}/%.o:  %.F
	$(FC) $(INC_COMMON) -o $@ -c $<


#######################################################################
#                         FINAL COMPILATION                           #
#######################################################################

# .__________________________________________________________________.
# |                                                                  |
# |        Link Fortran                                              |
# |__________________________________________________________________|

EXEC  = sufvm
EXECE = sufvm.exe

# .__________________________________________________________________.
# |                                                                  |
# |       Destination work directory                                 |
# |__________________________________________________________________|

DEST = input

# .__________________________________________________________________.
# |                                                                  |
# |   Compilation (NOT THAT WE COMMENT THE LAST TWO LINES: RTUFVM)   |
# |__________________________________________________________________|

all: 	   $(FOBJS)
#	   $(FLD) $(FOBJS) -o $(EXEC)
#	   $(MV) $(EXEC) $(DEST)

# .__________________________________________________________________.
# |                                                                  |
# |                            Cleaning                              |
# |__________________________________________________________________|

clean:    
	   $(RM) $(FOBJS) $(EXEC) *.mod 

#######################################################################
#                                                                     #
#                               END                                   #
#                                                                     #
#######################################################################

